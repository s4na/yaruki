# ğŸ§ª ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®‰å®šæ€§ãƒ†ã‚¹ãƒˆ

ãƒœã‚¿ãƒ³ä½ç½®ã¨ãƒœã‚¿ãƒ³é«˜ã•ãŒè³ªå•æ–‡ã®é•·ã•ã«é–¢ã‚ã‚‰ãšå®‰å®šã—ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã€‚

## ğŸ“‹ ãƒ†ã‚¹ãƒˆå†…å®¹

### 1. **DOMè¦ç´ ç¢ºèªãƒ†ã‚¹ãƒˆ**
- `.question-box` ãŒå­˜åœ¨ã™ã‚‹ã‹
- `.button-group` ãŒå­˜åœ¨ã™ã‚‹ã‹
- `.question-box h2` ãŒå­˜åœ¨ã™ã‚‹ã‹

### 2. **CSSãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ†ã‚¹ãƒˆ**
- `.question-box` ãŒ `display: flex` ã‹
- `.question-section` ãŒ `display: flex` ã‹
- `.button-group` ãŒ `flex-shrink: 0` ã‹

### 3. **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¸¬å®šãƒ†ã‚¹ãƒˆ**
- ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸Šç«¯ä½ç½®ï¼ˆTopï¼‰ã‚’è¨˜éŒ²
- ãƒœã‚¿ãƒ³ã®é«˜ã•ã‚’è¨˜éŒ²
- è¤‡æ•°ã®è³ªå•ã‚’é€šã˜ã¦å€¤ã®å¤‰åŒ–ã‚’ç›£è¦–

### 4. **å®‰å®šæ€§åˆ¤å®š**
- ãƒœã‚¿ãƒ³ä½ç½®ã®å·®åˆ†ãŒ5pxä»¥å†…ã‹ï¼ˆè¨±å®¹å€¤ï¼‰
- ãƒœã‚¿ãƒ³é«˜ã•ã®å·®åˆ†ãŒ2pxä»¥å†…ã‹ï¼ˆè¨±å®¹å€¤ï¼‰
- è¤‡æ•°ã®è³ªå•ã‚’é€šã˜ã¦å¤‰åŒ–ãŒãªã„ã‹

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ãƒ–ãƒ©ã‚¦ã‚¶UIï¼ˆç°¡å˜ï¼‰

```bash
# ãƒ†ã‚¹ãƒˆHTMLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
open tests/layout-test.html
# ã¾ãŸã¯
firefox tests/layout-test.html
```

**å³ä¸‹ã®ãƒ†ã‚¹ãƒˆãƒ‘ãƒãƒ«ã‹ã‚‰ï¼š**

1. **ã€Œãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€** - CSSè¨­å®šã¨DOMç¢ºèª
2. **ã€Œç›£è¦–é–‹å§‹ã€** - è¤‡æ•°ã®è³ªå•ã‚’æ‰‹å‹•ã§é€²ã‚ã‚‹
3. **ã€Œç›£è¦–åœæ­¢ã€** - çµæœã‚’ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º

### æ–¹æ³•2: ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«

ãƒ†ã‚¹ãƒˆHTMLã‚’é–‹ã„ãŸçŠ¶æ…‹ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ï¼š

```javascript
// ç¾åœ¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ¸¬å®š
monitor.measure()

// ãƒœã‚¿ãƒ³ä½ç½®ã®å®‰å®šæ€§ã‚’ãƒã‚§ãƒƒã‚¯
monitor.checkStability()

// ãƒœã‚¿ãƒ³é«˜ã•ã®ä¸€è²«æ€§ã‚’ãƒã‚§ãƒƒã‚¯
monitor.checkHeightConsistency()

// è¤‡æ•°ã®è³ªå•ã‚’è‡ªå‹•ã§é€²ã‚ã‚‹
startMonitoring()  // é–‹å§‹
stopMonitoring()   // åœæ­¢
```

### æ–¹æ³•3: Node.js ãƒ†ã‚¹ãƒˆ

```bash
npm test -- tests/layout-stability.test.js
```

## ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã®èª­ã¿æ–¹

### ãƒ‘ã‚¹ï¼ˆâœ“ï¼‰
```
âœ“ .question-box ã¯ flex
âœ“ .button-group ã¯ flex-shrink: 0
âœ“ ãƒœã‚¿ãƒ³ä½ç½®ã®å®‰å®šæ€§: âœ“ å®‰å®šã—ã¦ã„ã‚‹ï¼ˆå·®: 2pxã€è¨±å®¹å€¤: 5pxï¼‰
```
â†’ **è‰¯å¥½**ã€‚ãƒœã‚¿ãƒ³ä½ç½®ãŒå®‰å®šã—ã¦ã„ã¾ã™ã€‚

### å¤±æ•—ï¼ˆâœ—ï¼‰
```
âœ— ãƒœã‚¿ãƒ³ä½ç½®ã®å®‰å®šæ€§: âœ— ä¸å®‰å®šï¼ˆå·®: 15px > è¨±å®¹å€¤: 5pxï¼‰
```
â†’ **å•é¡Œã‚ã‚Š**ã€‚ãƒœã‚¿ãƒ³ä½ç½®ãŒæœ€å¤§15pxã‚‚å¤‰å‹•ã—ã¦ã„ã¾ã™ã€‚

## ğŸ” æ¸¬å®šãƒ†ãƒ¼ãƒ–ãƒ«ã®è¦‹æ–¹

```
è³ªå•    | Top | Height
--------|-----|-------
q1      | 500 | 56
q2      | 508 | 56    â† 8pxä¸Šã«ç§»å‹•ï¼ˆå•é¡Œï¼ï¼‰
q3      | 505 | 56
q4      | 495 | 56    â† 13pxä¸‹ã«ç§»å‹•ï¼ˆå•é¡Œï¼ï¼‰
```

**åˆ†æï¼š**
- Top ãŒ 500px ã‹ã‚‰ 508px ã«å¤‰å‹• â†’ ãƒœã‚¿ãƒ³ä½ç½®ãŒä¸å®‰å®š
- Height ã¯ä¸€å®š â†’ ãƒœã‚¿ãƒ³è‡ªä½“ã®é«˜ã•ã¯å•é¡Œãªã„
- è³ªå•æ–‡ã®é•·ã•ã«å¿œã˜ã¦ä¸Šä¸‹ã«å‹•ã„ã¦ã„ã‚‹

## ğŸ› å•é¡ŒãŒè¦‹ã¤ã‹ã£ãŸå ´åˆ

### ç—‡çŠ¶: ãƒœã‚¿ãƒ³ä½ç½®ãŒä¸Šä¸‹ã«å‹•ãï¼ˆTopå€¤ãŒå¤§ããå¤‰ã‚ã‚‹ï¼‰

**åŸå› å€™è£œ:**
1. `.question-box` ãŒ `flex: 1` ã«ãªã£ã¦ã„ãªã„
2. `.question-box h2` ã« `margin-bottom: auto` ãŒãªã„
3. `.button-group` ã« `flex-shrink: 0` ãŒãªã„
4. è¦ªè¦ç´ ã« `min-height` ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

**ç¢ºèªæ–¹æ³•:**
```javascript
// CSSã‚’ç¢ºèª
const style = window.getComputedStyle(document.querySelector('.question-box'));
console.log('flex:', style.flex);
console.log('flex-direction:', style.flexDirection);

const h2Style = window.getComputedStyle(document.querySelector('.question-box h2'));
console.log('margin-bottom:', h2Style.marginBottom);
```

### ç—‡çŠ¶: ãƒœã‚¿ãƒ³é«˜ã•ãŒå¤‰ã‚ã‚‹ï¼ˆHeightå€¤ãŒç•°ãªã‚‹ï¼‰

**åŸå› å€™è£œ:**
1. è³ªå•ãƒ†ã‚­ã‚¹ãƒˆãŒ h2 ã¨åŒã˜é ˜åŸŸå†…ã«ã‚ã‚‹
2. ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚„ãƒãƒ¼ã‚¸ãƒ³ãŒå‹•çš„ã«å¤‰ã‚ã£ã¦ã„ã‚‹
3. ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºãŒå¤‰å‹•ã—ã¦ã„ã‚‹
4. line-height ãŒå›ºå®šã•ã‚Œã¦ã„ãªã„

**ç¢ºèªæ–¹æ³•:**
```javascript
// ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã®è©³ç´°ã‚’ç¢ºèª
const bg = document.querySelector('.button-group');
const style = window.getComputedStyle(bg);
console.log('height:', bg.getBoundingClientRect().height);
console.log('padding:', style.padding);
console.log('flex-shrink:', style.flexShrink);
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

ãƒœã‚¿ãƒ³ä½ç½®ãŒé »ç¹ã«æ›´æ–°ã•ã‚Œã‚‹å ´åˆã®æ¤œæŸ»ï¼š

```javascript
// 100ms ã”ã¨ã«ãƒœã‚¿ãƒ³ä½ç½®ã®å¤‰åŒ–ã‚’ç›£è¦–ï¼ˆ5ç§’é–“ï¼‰
startMonitoring();
setTimeout(() => {
    stopMonitoring();
    // çµæœã‚’ç¢ºèª
}, 5000);
```

## âœ… ãƒ†ã‚¹ãƒˆåˆæ ¼ã®åŸºæº–

| é …ç›® | åŸºæº– | è¨±å®¹å€¤ |
|------|------|--------|
| ãƒœã‚¿ãƒ³ä½ç½®ã®å®‰å®šæ€§ | è¤‡æ•°è³ªå•ã§Topä½ç½®ãŒå¤‰ã‚ã‚‰ãªã„ | Â±5px |
| ãƒœã‚¿ãƒ³é«˜ã•ã®ä¸€è²«æ€§ | ã™ã¹ã¦ã®è³ªå•ã§åŒã˜é«˜ã• | Â±2px |
| DOMæ§‹é€  | å¿…é ˆè¦ç´ ãŒã™ã¹ã¦å­˜åœ¨ | - |
| CSSè¨­å®š | flexé–¢é€£ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ­£ã—ã„ | - |

## ğŸ“ ä½¿ç”¨ä¾‹

### ä¾‹1: ã‚¯ã‚¤ãƒƒã‚¯ãƒã‚§ãƒƒã‚¯

```javascript
// ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã€ç°¡å˜ãªãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º
runLayoutTests()
```

**å‡ºåŠ›:**
```
âœ“ DOMç¢ºèª: .question-box
âœ“ DOMç¢ºèª: .button-group
âœ“ CSS: .question-box ã¯ flex
âœ“ CSS: .question-section ã¯ flex
âœ“ CSS: .button-group flex-shrink: 0
â„¹ ç¾åœ¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¸¬å®š:
â„¹ ãƒœã‚¿ãƒ³ãƒˆãƒƒãƒ—ä½ç½®: 500px
â„¹ ãƒœã‚¿ãƒ³é«˜ã•: 56px
```

### ä¾‹2: è©³ç´°ãªç›£è¦–

```javascript
// è³ªå•ã‚’1ã¤é€²ã‚ã‚‹
document.getElementById('yes-btn').click()

// æ–°ã—ã„è³ªå•ã§æ¸¬å®š
monitor.record('q2')

// å®‰å®šæ€§ã‚’ãƒã‚§ãƒƒã‚¯
monitor.checkStability()
// å‡ºåŠ›: {isStable: false, variance: 15, ...}
```

### ä¾‹3: ç¶™ç¶šçš„ãªç›£è¦–

```javascript
// ç›£è¦–ã‚’é–‹å§‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè³ªå•ã‚’é€²ã‚ã‚‹é–“ï¼‰
startMonitoring()

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®è³ªå•ã«ç­”ãˆã‚‹...

// ç›£è¦–ã‚’åœæ­¢ã—ã¦ã€ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
stopMonitoring()
// è©³ç´°ãªãƒ†ãƒ¼ãƒ–ãƒ«ã¨ãƒ¬ãƒãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q: "ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ" ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹

**A:** CORSã‚¨ãƒ©ãƒ¼ã§ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«Webã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```bash
# Python 3
python3 -m http.server 8000

# ã¾ãŸã¯ Node.js
npx http-server
```

ãã®å¾Œã€`http://localhost:8000/tests/layout-test.html` ã§é–‹ã

### Q: ãƒ†ã‚¹ãƒˆçµæœãŒãŠã‹ã—ã„

**A:** ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„ï¼š

```javascript
// æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
monitor.clear()

// ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
location.reload()

// ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
runLayoutTests()
```

### Q: ãƒœã‚¿ãƒ³ä½ç½®ã¯å®‰å®šã—ã¦ã„ã‚‹ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œæºã‚Œã‚‹ã€ã¨è¨€ã†

**A:** çŸ¥è¦šçš„ãªæºã‚ŒãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„ï¼š

```javascript
// ã‚ˆã‚Šå¤šãã®æ¸¬å®šã‚’å–å¾—
startMonitoring()
// 5ç§’å¾…æ©Ÿ
setTimeout(() => stopMonitoring(), 5000)

// ã‚ˆã‚Šå³ã—ã„åŸºæº–ã§ãƒã‚§ãƒƒã‚¯
monitor.checkStability(2)  // è¨±å®¹å€¤ã‚’2pxã«
```

## ğŸ“š å‚è€ƒ

- [Flexboxä»•æ§˜](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout)
- [margin: auto ã®ä½¿ç”¨](https://developer.mozilla.org/en-US/docs/Web/CSS/margin)
- [flex-shrink ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£](https://developer.mozilla.org/en-US/docs/Web/CSS/flex-shrink)

---

**ä½œæˆæ—¥**: 2025å¹´11æœˆ17æ—¥
**ãƒ†ã‚¹ãƒˆå¯¾è±¡**: ãƒœã‚¿ãƒ³ä½ç½®ã®å®‰å®šæ€§
**è¨±å®¹å€¤**: ãƒœã‚¿ãƒ³Topä½ç½® Â±5pxã€ãƒœã‚¿ãƒ³é«˜ã• Â±2px
